graph TD
    subgraph "User's Browser"
        User
    end

    subgraph "Backend Infrastructure (Docker)"
        A[FastAPI Application]
        B[LlamaIndex Query Engine]
        C[PostgreSQL w/ pgvector]
        D[Redis Rate Limiter]
        G[Structured Logging]
    end

    subgraph "External Services & Platforms"
        E[OpenRouter API]
        F[Langfuse Platform]
        H[Log Aggregation<br/>ELK/Loki/OTEL]
    end

    User --"1. HTTPS Request<br/>+ X-Trace-ID"--> A;
    A --"2. Rate Limit Check"--> D;
    A --"3. Generate<br/>Correlation IDs"--> G;
    A --"4. Query"--> B;
    B --"5. Retrieve Context"--> C;
    B --"6. Prompt + Context"--> E;
    A --"7. Send Trace Data<br/>+ trace_id"--> F;
    B --"8. Send Trace Data<br/>+ trace_id"--> F;
    E --"9. LLM Response"--> B;
    B --"10. Final Answer"--> A;
    A --"11. JSON Response<br/>+ X-Request-ID"--> User;
    G --"12. JSON Logs<br/>+ Correlation IDs"--> H; 