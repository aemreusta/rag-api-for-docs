# Coding Structure

## Embeddings Default and Schema Alignment

The project defaults to Google Gemini embeddings using `gemini-embedding-001` and `EMBEDDING_DIM=3072`. If you change the embedding dimension (supported via MRL: 3072/1536/768), ensure the PostgreSQL `content_vector` column type (`VECTOR(<dim>)`) and HNSW index are aligned. See `app/db/models.py`, Alembic migrations, and `README.md` for guidance.

### Coding Structure (essentials)

Keep it simple, explicit, and testable.

## Principles

- Single responsibility per module.
- Depend on abstractions, not implementations.
- Prefer explicit configs and types over magic.
- Baseline runtime: Python 3.11; feel free to use pattern matching, `Self` types, `typing` improvements available in 3.11.

## Apply it here

- `api/v1/chat.py`: orchestrates requests; no RAG logic.
- `core/query_engine.py`: LlamaIndex integration behind a small interface.
- `core/config.py`: environment and settings only.

## Examples

```python
# Good: explicit types and return values
def answer(question: str, history: list[str]) -> tuple[str, float]:
    ...

# Avoid: implicit, hard to test
def answer(*args):
    ...
```

## Configuration

- Put values in `.env`, not code.
- Keep prompts or long text outside Python where possible.

## Testing checklist

- Small, pure functions where you can.
- Use dependency injection for I/O and clients.
- Handle edge cases first with clear errors.
